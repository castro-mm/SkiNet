import{b as m,ma as h}from"./chunk-66ZLYJGL.js";import{Gc as c,ea as d,ja as u,qb as s,x as p}from"./chunk-KOJY6QOY.js";var C="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";var f=(a=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(a));for(;a--;)t+=C[r[a]&63];return t};var o=class{id=f();items=[];deliveryMethodId;paymentIntentId;clientSecret};var I=class a{constructor(t){this.http=t}baseApiUrl=h.apiUrl;cart=s(null);selectedDelivery=s(null);get itemsCount(){return c(()=>this.cart()?.items.reduce((t,r)=>t+r.quantity,0))}get totals(){return c(()=>{let t=this.cart(),r=this.selectedDelivery();if(!t)return;let e=t.items.reduce((b,l)=>(b+l.price)*l.quantity,0),i=r?r.price:0,n=0;return{subtotal:e,shipping:i,discount:n,total:e+i-n}})}getCart(t){return this.http.get(`${this.baseApiUrl}cart?id=${t}`).pipe(p(r=>(this.cart.set(r),r)))}setCart(t){return this.http.post(`${this.baseApiUrl}cart`,t).subscribe({next:r=>this.cart.set(r)})}deleteCart(){this.http.delete(`${this.baseApiUrl}cart?id=${this.cart()?.id}`).subscribe({next:()=>{localStorage.removeItem("cart_id"),this.cart.set(null)}})}addItemToCart(t,r=1){let e=this.cart()??this.createCart();this.isProduct(t)&&(t=this.mapProductToCartItem(t)),e.items=this.addOrUpdateItem(e.items,t,r),this.setCart(e)}removeItemFromCart(t,r=1){let e=this.cart();if(!e)return;let i=e.items.findIndex(n=>n.productId==t);i!==-1&&(e.items[i].quantity>r?e.items[i].quantity-=r:e.items.splice(i,1),e.items.length===0?this.deleteCart():this.setCart(e))}addOrUpdateItem(t,r,e){let i=t.findIndex(n=>n.productId==r.productId);return i===-1?(r.quantity=e,t.push(r)):t[i].quantity+=e,t}mapProductToCartItem(t){return{productId:t.id,productName:t.name,price:t.price,quantity:0,pictureUrl:t.pictureUrl,brand:t.brand,type:t.type}}isProduct(t){return t.id!==void 0}createCart(){let t=new o;return localStorage.setItem("cart_id",t.id),t}static \u0275fac=function(r){return new(r||a)(u(m))};static \u0275prov=d({token:a,factory:a.\u0275fac,providedIn:"root"})};export{I as a};
